version = 1

[install]
python.pkg-path = "python313"
uv.pkg-path = "uv"
comfyui-scripts.pkg-path = "flox/comfyui-scripts"

[vars]
COMFYUI_HOST = "localhost"
COMFYUI_PORT = "8188"
COMFYUI_WORKFLOWS = "/home/daedalus/comfyui-work/user/default/workflows"

[hook]
on-activate = '''
# Create workflows symlink if target exists
if [ -d "$COMFYUI_WORKFLOWS" ] && [ ! -e "workflows" ]; then
  ln -s "$COMFYUI_WORKFLOWS" workflows
fi

# Setup Python venv
FLOX_PYTHON=$(which python)
if [ ! -d ".venv" ]; then
  uv venv .venv --python "$FLOX_PYTHON"
fi

unset PYTHONPATH
source .venv/bin/activate

if [ ! -f ".venv/.deps_installed" ] || [ ! -f ".venv/bin/comfyui-queue" ]; then
  uv pip install -e ".[dev]"
  touch .venv/.deps_installed
fi
'''

[profile]
common = '''
export PATH="$FLOX_ENV_PROJECT/.venv/bin:$PATH"
'''

bash = '''
unset PYTHONPATH
source "$FLOX_ENV_PROJECT/.venv/bin/activate" 2>/dev/null || true
'''

zsh = '''
unset PYTHONPATH
source "$FLOX_ENV_PROJECT/.venv/bin/activate" 2>/dev/null || true
'''

fish = '''
set -e PYTHONPATH 2>/dev/null
if test -f "$FLOX_ENV_PROJECT/.venv/bin/activate.fish"
    source "$FLOX_ENV_PROJECT/.venv/bin/activate.fish"
end
'''
